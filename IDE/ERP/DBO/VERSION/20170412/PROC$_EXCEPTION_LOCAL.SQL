CREATE OR ALTER PROCEDURE PROC$_EXCEPTION_LOCAL (
  Q_OBJ_ID TYPE OF COLUMN TABL$_LOCAL.OBJ_ID,
  Q_COL_ID TYPE OF COLUMN TABL$_LOCAL.COL_ID,
  Q_REC_ID TYPE OF COLUMN TABL$_LOCAL.REC_ID = NULL)
AS
  DECLARE VARIABLE P_MESSAGE TYPE OF COLUMN TABL$_LOCAL.NAME;
BEGIN
  SELECT FIRST 1 P.MESSAGESTR
  FROM   PROC$_LOCAL(:Q_OBJ_ID, :Q_COL_ID, :Q_REC_ID) P
  INTO   :P_MESSAGE;

  IF(TRIM(:P_MESSAGE) = '')THEN
    P_MESSAGE = '<< Unknown Error >>';

  P_MESSAGE =
    '  '||ASCII_CHAR(13)||ASCII_CHAR(10)||
    '  '||ASCII_CHAR(13)||ASCII_CHAR(10)||
    :P_MESSAGE||ASCII_CHAR(13)||ASCII_CHAR(10)||
    '  '||ASCII_CHAR(13)||ASCII_CHAR(10)||
    '  '||ASCII_CHAR(13)||ASCII_CHAR(10);

  EXCEPTION EXPT$_ERROR_00000 :P_MESSAGE;
END
